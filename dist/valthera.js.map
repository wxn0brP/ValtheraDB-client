{
  "version": 3,
  "sources": ["../node_modules/@wxn0brp/db-core/dist/helpers/collection.js", "../src/function.ts", "../src/version.ts", "../src/valthera.ts"],
  "sourcesContent": [
    "export class Collection {\n    db;\n    collection;\n    constructor(db, collection) {\n        this.db = db;\n        this.collection = collection;\n    }\n    add(data, id_gen) {\n        return this.db.add({ collection: this.collection, data, id_gen });\n    }\n    /**\n     * Find data in a database.\n     */\n    find(search = {}, options = {}, findOpts = {}, context = {}) {\n        return this.db.find({ collection: this.collection, search, dbFindOpts: options, findOpts, context });\n    }\n    /**\n     * Find one data entry in a database.\n     */\n    findOne(search = {}, findOpts = {}, context = {}) {\n        return this.db.findOne({ collection: this.collection, search, findOpts, context });\n    }\n    /**\n     * Update data in a database.\n     */\n    update(search, updater, context = {}) {\n        return this.db.update({ collection: this.collection, search, updater, context });\n    }\n    /**\n     * Update one data entry in a database.\n     */\n    updateOne(search, updater, context = {}) {\n        return this.db.updateOne({ collection: this.collection, search, updater, context });\n    }\n    /**\n     * Remove data from a database.\n     */\n    remove(search, context = {}) {\n        return this.db.remove({ collection: this.collection, search, context });\n    }\n    /**\n     * Remove one data entry from a database.\n     */\n    removeOne(search, context = {}) {\n        return this.db.removeOne({ collection: this.collection, search, context });\n    }\n    /**\n     * Asynchronously updates one entry in a database or adds a new one if it doesn't exist.\n     */\n    updateOneOrAdd(search, updater, { add_arg = {}, context = {}, id_gen = true } = {}) {\n        return this.db.updateOneOrAdd({ collection: this.collection, search, updater, add_arg, context, id_gen });\n    }\n    /**\n     * Asynchronously removes one entry in a database or adds a new one if it doesn't exist. Usage e.g. for toggling a flag.\n     */\n    toggleOne(search, data = {}, context = {}) {\n        return this.db.toggleOne({ collection: this.collection, search, data, context });\n    }\n}\n",
    "export function serializeFunctions(data: Object) {\n    const functionKeys: string[] = [];\n\n    function convertFunctionToString(fn: any) {\n        return typeof fn === \"function\" ? fn.toString() : fn;\n    }\n\n    function traverseAndSerialize(obj: Object, path: string = \"\") {\n        Object.keys(obj).forEach((key) => {\n            const value = obj[key];\n            const fullPath = path ? `${path}.${key.replace(/\\./g, \"[dot]\")}` : key;\n\n            if (typeof value === \"function\") {\n                functionKeys.push(fullPath);\n                obj[key] = convertFunctionToString(value);\n            } else if (Array.isArray(value)) {\n                value.forEach((item, index) => {\n                    if (typeof item === \"function\") {\n                        functionKeys.push(`${fullPath}[${index}]`);\n                        value[index] = convertFunctionToString(item);\n                    }\n                });\n            } else if (typeof value === \"object\" && value !== null) {\n                traverseAndSerialize(value, fullPath);\n            }\n        });\n    }\n\n    traverseAndSerialize(data);\n    return { data, keys: functionKeys };\n}\n",
    "export const version = \"0.0.1\";",
    "import { Collection } from \"@wxn0brp/db-core/helpers/collection\";\nimport { Data } from \"@wxn0brp/db-core/types/data\";\nimport {\n    AddQuery,\n    FindOneQuery,\n    FindQuery,\n    RemoveQuery,\n    ToggleOneQuery,\n    UpdateOneOrAddQuery,\n    UpdateQuery,\n    ValtheraCompatible\n} from \"@wxn0brp/db-core/types/valthera\";\nimport { serializeFunctions } from \"./function\";\nimport { Remote, RequestData } from \"./remote\";\nimport { version } from \"./version\";\n\n/**\n * Represents a database management class for performing CRUD operations.\n * Uses a remote database.\n * @class\n */\nexport class ValtheraRemote implements ValtheraCompatible {\n    remote: Remote;\n    version = version;\n\n    constructor(remote: Remote | string) {\n        if (typeof remote === \"string\") {\n            const urlObj = new URL(remote);\n            const name = urlObj.username;\n            const auth = urlObj.password;\n            if (!name || !auth) throw new Error(\"Invalid remote database\");\n\n            urlObj.username = \"\";\n            urlObj.password = \"\";\n            const url = urlObj.toString().slice(0, -1);\n\n            this.remote = {\n                name,\n                url,\n                auth\n            };\n        } else this.remote = remote;\n        if (this.remote.url.endsWith(\"/\")) this.remote.url = this.remote.url.slice(0, -1);\n    }\n\n    /**\n     * Make a request to the remote database.\n     */\n    async _request<T>(type: string, params = []) {\n        const processed = serializeFunctions(params);\n        const data: RequestData = {\n            db: this.remote.name,\n            params: processed.data,\n            keys: processed.keys\n        };\n        const url = this.remote.url + \"/db/\" + type;\n        const res = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": this.remote.auth\n            },\n            body: JSON.stringify(data)\n        }).then(res => res.json()) as { err: boolean, msg: string, result: any };\n\n        if (res.err) throw new Error(res.msg);\n        return res.result as T;\n    }\n\n    /**\n     * Create a new instance of a CollectionManager class.\n     */\n    c(collection: string) {\n        return new Collection(this, collection);\n    }\n\n    /**\n     * Get the names of all available databases.\n     */\n    getCollections() {\n        return this._request<string[]>(\"getCollections\", []);\n    }\n\n    /**\n     * Check and create the specified collection if it doesn't exist.\n     */\n    ensureCollection(collection: string) {\n        return this._request<boolean>(\"ensureCollection\", [collection]);\n    }\n\n    /**\n     * Check if a collection exists.\n     */\n    issetCollection(collection: string) {\n        return this._request<boolean>(\"issetCollection\", [collection]);\n    }\n\n    /**\n     * Add data to a database.\n     */\n    add<T = Data>(query: AddQuery) {\n        return this._request<T>(\"add\", [query]);\n    }\n\n    /**\n     * Find data in a database.\n     */\n    find<T = Data>(query: FindQuery) {\n        return this._request<T[]>(\"find\", [query]);\n    }\n\n    /**\n     * Find one data entry in a database.\n     */\n    findOne<T = Data>(query: FindOneQuery) {\n        return this._request<T | null>(\"findOne\", [query]);\n    }\n\n    /**\n     * Update data in a database.\n     */\n    update<T = Data>(query: UpdateQuery) {\n        return this._request<T[]>(\"update\", [query]);\n    }\n\n    /**\n     * Update one data entry in a database.\n     */\n    updateOne<T = Data>(query: UpdateQuery) {\n        return this._request<T | null>(\"updateOne\", [query]);\n    }\n\n    /**\n     * Remove data from a database.\n     */\n    remove<T = Data>(query: RemoveQuery) {\n        return this._request<T[]>(\"remove\", [query]);\n    }\n\n    /**\n     * Remove one data entry from a database.\n     */\n    removeOne<T = Data>(query: RemoveQuery) {\n        return this._request<T | null>(\"removeOne\", [query]);\n    }\n\n    /**\n     * Asynchronously updates one entry in a database or adds a new one if it doesn't exist.\n     */\n    updateOneOrAdd<T = Data>(query: UpdateOneOrAddQuery) {\n        return this._request<T | null>(\"updateOneOrAdd\", [query]);\n    }\n\n    /**\n     * Asynchronously removes one entry in a database or adds a new one if it doesn't exist. Usage e.g. for toggling a flag.\n     */\n    toggleOne<T = Data>(query: ToggleOneQuery) {\n        return this._request<T | null>(\"toggleOne\", [query]);\n    }\n\n    /**\n     * Removes a database collection from the file system.\n     */\n    removeCollection(name: string) {\n        return this._request<boolean>(\"removeCollection\", [name]);\n    }\n}\n"
  ],
  "mappings": "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",
  "debugId": "419585E44878E9A064756E2164756E21",
  "names": []
}