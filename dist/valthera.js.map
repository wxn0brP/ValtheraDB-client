{
  "version": 3,
  "sources": ["../node_modules/@wxn0brp/db-core/dist/helpers/collectionManager.js", "../src/function.ts", "../src/version.ts", "../src/valthera.ts"],
  "sourcesContent": [
    "export class CollectionManager {\n    db;\n    collection;\n    constructor(db, collection) {\n        this.db = db;\n        this.collection = collection;\n    }\n    /**\n     * Add data to a database.\n     */\n    async add(data, id_gen = true) {\n        return await this.db.add(this.collection, data, id_gen);\n    }\n    /**\n     * Find data in a database.\n     */\n    async find(search = {}, options = {}, findOpts = {}, context = {}) {\n        return await this.db.find(this.collection, search, options, findOpts, context);\n    }\n    /**\n     * Find one data entry in a database.\n     */\n    async findOne(search = {}, findOpts = {}, context = {}) {\n        return await this.db.findOne(this.collection, search, findOpts, context);\n    }\n    /**\n     * Update data in a database.\n     */\n    async update(search, updater, context = {}) {\n        return await this.db.update(this.collection, search, updater, context);\n    }\n    /**\n     * Update one data entry in a database.\n     */\n    async updateOne(search, updater, context = {}) {\n        return await this.db.updateOne(this.collection, search, updater, context);\n    }\n    /**\n     * Remove data from a database.\n     */\n    async remove(search, context = {}) {\n        return await this.db.remove(this.collection, search, context);\n    }\n    /**\n     * Remove one data entry from a database.\n     */\n    async removeOne(search, context = {}) {\n        return await this.db.removeOne(this.collection, search, context);\n    }\n    /**\n     * Asynchronously updates one entry in a database or adds a new one if it doesn't exist.\n     */\n    async updateOneOrAdd(search, updater, { add_arg = {}, context = {}, id_gen = true } = {}) {\n        return await this.db.updateOneOrAdd(this.collection, search, updater, { add_arg, context, id_gen });\n    }\n    /**\n     * Asynchronously removes one entry in a database or adds a new one if it doesn't exist. Usage e.g. for toggling a flag.\n     */\n    async toggleOne(search, data = {}, context = {}) {\n        return await this.db.toggleOne(this.collection, search, data, context);\n    }\n}\n",
    "function serializeFunctions(data: Object) {\n    const functionKeys: string[] = [];\n\n    function convertFunctionToString(fn: any) {\n        return typeof fn === \"function\" ? fn.toString() : fn;\n    }\n\n    function traverseAndSerialize(obj: Object, path: string = \"\") {\n        Object.keys(obj).forEach((key) => {\n            const value = obj[key];\n            const fullPath = path ? `${path}.${key.replace(/\\./g, \"[dot]\")}` : key;\n\n            if (typeof value === \"function\") {\n                functionKeys.push(fullPath);\n                obj[key] = convertFunctionToString(value);\n            } else if (Array.isArray(value)) {\n                value.forEach((item, index) => {\n                    if (typeof item === \"function\") {\n                        functionKeys.push(`${fullPath}[${index}]`);\n                        value[index] = convertFunctionToString(item);\n                    }\n                });\n            } else if (typeof value === \"object\" && value !== null) {\n                traverseAndSerialize(value, fullPath);\n            }\n        });\n    }\n\n    traverseAndSerialize(data);\n    return { data, keys: functionKeys };\n}\n\nexport default serializeFunctions;",
    "export const version = \"0.0.1\";",
    "import { CollectionManager } from \"@wxn0brp/db-core/helpers/collectionManager\";\nimport { Arg, Search, Updater } from \"@wxn0brp/db-core/types/arg\";\nimport Data from \"@wxn0brp/db-core/types/data\";\nimport { DbFindOpts, FindOpts } from \"@wxn0brp/db-core/types/options\";\nimport { VContext } from \"@wxn0brp/db-core/types/types\";\nimport { UpdateOneOrAdd, ValtheraCompatible } from \"@wxn0brp/db-core/types/valthera\";\nimport serializeFunctions from \"./function\";\nimport { Remote, RequestData } from \"./remote\";\nimport { version } from \"./version\";\n\n/**\n * Represents a database management class for performing CRUD operations.\n * Uses a remote database.\n * @class\n */\nexport class ValtheraRemote implements ValtheraCompatible {\n    remote: Remote;\n    version = version;\n\n    constructor(remote: Remote | string) {\n        if (typeof remote === \"string\") {\n            const urlObj = new URL(remote);\n            const name = urlObj.username;\n            const auth = urlObj.password;\n            if (!name || !auth) throw new Error(\"Invalid remote database\");\n\n            urlObj.username = \"\";\n            urlObj.password = \"\";\n            const url = urlObj.toString().slice(0, -1);\n\n            this.remote = {\n                name,\n                url,\n                auth\n            };\n        } else this.remote = remote;\n        if (this.remote.url.endsWith(\"/\")) this.remote.url = this.remote.url.slice(0, -1);\n    }\n\n    /**\n     * Make a request to the remote database.\n     */\n    async _request<T>(type: string, params = []) {\n        const processed = serializeFunctions(params);\n        const data: RequestData = {\n            db: this.remote.name,\n            params: processed.data,\n            keys: processed.keys\n        };\n        const url = this.remote.url + \"/db/\" + type;\n        const res = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": this.remote.auth\n            },\n            body: JSON.stringify(data)\n        }).then(res => res.json()) as { err: boolean, msg: string, result: any };\n\n        if (res.err) throw new Error(res.msg);\n        return res.result as T;\n    }\n\n    /**\n     * Create a new instance of a CollectionManager class.\n     */\n    c(collection: string) {\n        return new CollectionManager(this, collection);\n    }\n\n    /**\n     * Get the names of all available databases.\n     */\n    async getCollections() {\n        return await this._request(\"getCollections\", []) as string[];\n    }\n\n    /**\n     * Check and create the specified collection if it doesn't exist.\n     */\n    async ensureCollection(collection: string) {\n        return await this._request(\"ensureCollection\", [collection]) as boolean;\n    }\n\n    /**\n     * Check if a collection exists.\n     */\n    async issetCollection(collection: string) {\n        return await this._request(\"issetCollection\", [collection]) as boolean;\n    }\n\n    /**\n     * Add data to a database.\n     */\n    async add<T = Data>(collection: string, data: Arg<T>, id_gen = true) {\n        return await this._request(\"add\", [collection, data, id_gen]) as T;\n    }\n\n    /**\n     * Find data in a database.\n     */\n    async find<T = Data>(collection: string, search: Search<T>, options: DbFindOpts<T> = {}, findOpts: FindOpts<T> = {}, context: VContext = {}) {\n        return await this._request(\"find\", [collection, search, options, findOpts, context]) as T[];\n    }\n\n    /**\n     * Find one data entry in a database.\n     */\n    async findOne<T = Data>(collection: string, search: Search<T>, findOpts: FindOpts<T> = {}, context: VContext = {}) {\n        return await this._request(\"findOne\", [collection, search, findOpts, context]) as (T | null);\n    }\n\n    /**\n     * Update data in a database.\n     */\n    async update<T = Data>(collection: string, search: Search<T>, updater: Updater<T>, context: VContext = {}) {\n        return await this._request(\"update\", [collection, search, updater, context]) as boolean;\n    }\n\n    /**\n     * Update one data entry in a database.\n     */\n    async updateOne<T = Data>(collection: string, search: Search<T>, updater: Updater<T>, context: VContext = {}) {\n        return await this._request(\"updateOne\", [collection, search, updater, context]) as boolean;\n    }\n\n    /**\n     * Remove data from a database.\n     */\n    async remove<T = Data>(collection: string, search: Search<T>, context: VContext = {}) {\n        return await this._request(\"remove\", [collection, search, context]) as boolean;\n    }\n\n    /**\n     * Remove one data entry from a database.\n     */\n    async removeOne<T = Data>(collection: string, search: Search<T>, context: VContext = {}) {\n        return await this._request(\"removeOne\", [collection, search, context]) as boolean;\n    }\n\n    /**\n     * Asynchronously updates one entry in a database or adds a new one if it doesn't exist.\n     */\n    async updateOneOrAdd<T = Data>(collection: string, search: Search<T>, arg: Search<T>, opts: UpdateOneOrAdd<T>) {\n        return await this._request(\"updateOneOrAdd\", [collection, search, arg, opts]) as boolean;\n    }\n\n    /**\n     * Asynchronously removes one entry in a database or adds a new one if it doesn't exist. Usage e.g. for toggling a flag.\n     */\n    async toggleOne<T = Data>(collection: string, search: Search<T>, data?: Arg<T>, context?: VContext) {\n        return await this._request(\"toggleOne\", [collection, search, data, context]) as boolean;\n    }\n\n    /**\n     * Removes a database collection from the file system.\n     */\n    async removeCollection(name: string) {\n        return await this._request<boolean>(\"removeCollection\", [name]) as boolean;\n    }\n}\n\nexport default ValtheraRemote;\n"
  ],
  "mappings": "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",
  "debugId": "6D0E6EE44172AC0D64756E2164756E21",
  "names": []
}